<!DOCTYPE html>
<html lang="de" data-theme="pastel">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schüler-Verspätungs-Tracker</title>

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- ICONS -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- ANIMATION -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <!-- PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- DAISYUI & TAILWIND -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.0/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- TAILWIND CONFIG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    borderRadius: {
                        'box': '1rem',
                        'btn': '9999px',
                    }
                }
            }
        }
    </script>

    <!-- CUSTOM STYLES -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="min-h-screen text-base-content bg-base-200 flex flex-col md:flex-row overflow-hidden">

    <!-- SIDEBAR (Desktop) -->
    <aside class="hidden md:flex flex-col w-64 bg-base-100 border-r border-base-300 h-screen p-4 z-20">
        <div class="flex items-center gap-3 mb-8 px-2">
            <div class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white">
                <i data-lucide="clock" class="w-6 h-6"></i>
            </div>
            <h1 class="font-bold text-xl tracking-tight">ZeitTracker</h1>
        </div>

        <div class="flex-1 overflow-y-auto">
            <h3 class="text-xs font-semibold text-base-content/50 uppercase tracking-wider mb-3 px-2">Klassen</h3>
            <ul id="classList" class="menu w-full p-0 gap-2">
                <!-- Class Items injected here -->
            </ul>
        </div>

        <div class="mt-4 pt-4 border-t border-base-300">
            <button onclick="app.handlers.openAddClassModal()"
                class="btn btn-outline btn-primary w-full rounded-full gap-2">
                <i data-lucide="plus" class="w-4 h-4"></i>
                Neue Klasse
            </button>
        </div>
    </aside>

    <!-- MOBILE HEADER -->
    <div class="md:hidden flex items-center justify-between p-4 bg-base-100 border-b border-base-300 z-20">
        <div class="flex items-center gap-2">
            <i data-lucide="clock" class="text-primary w-6 h-6"></i>
            <span class="font-bold text-lg">ZeitTracker</span>
        </div>
        <button class="btn btn-ghost btn-circle" onclick="document.getElementById('mobile_drawer').showModal()">
            <i data-lucide="menu"></i>
        </button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <!-- TOP BAR -->
        <header
            class="h-16 border-b border-base-300 bg-base-100/50 backdrop-blur-sm flex items-center justify-between px-6 z-10">
            <div class="flex items-center gap-4">
                <h2 id="viewTitle" class="text-2xl font-bold flex items-center gap-2">
                    <!-- Dynamic Title -->
                    Übersicht
                </h2>
                <!-- SYNC STATUS -->
                <div id="syncStatus"
                    class="hidden flex items-center gap-2 text-xs font-medium bg-base-200 px-3 py-1 rounded-full border border-base-300">
                    <span class="relative flex h-2 w-2">
                        <span id="syncDotPing"
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-success opacity-75"></span>
                        <span id="syncDot" class="relative inline-flex rounded-full h-2 w-2 bg-success"></span>
                    </span>
                    <span id="syncText">Online</span>
                </div>
            </div>

            <div class="flex items-center gap-2">
                <!-- View Switcher -->
                <div class="join bg-base-200 p-1 rounded-full border border-base-300">
                    <button class="join-item btn btn-sm btn-ghost rounded-full px-4" id="btnViewDay"
                        onclick="app.handlers.setView('day')">Tag</button>
                    <button class="join-item btn btn-sm btn-ghost rounded-full px-4" id="btnViewMonth"
                        onclick="app.handlers.setView('month')">Monat</button>
                </div>

                <div class="divider divider-horizontal py-2 mx-0"></div>

                <!-- Date Navigation -->
                <div class="flex items-center gap-1 bg-base-100 border border-base-300 rounded-full p-1 pl-3 pr-1">
                    <span id="currentDateDisplay" class="text-sm font-medium mr-2">Januar 2026</span>
                    <button class="btn btn-xs btn-circle btn-ghost" onclick="app.handlers.changeDate(-1)">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i>
                    </button>
                    <button class="btn btn-xs btn-circle btn-ghost" onclick="app.handlers.changeDate(1)">
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </button>
                </div>

                <div class="divider divider-horizontal py-2 mx-0"></div>

                <button class="btn btn-sm btn-ghost btn-circle" title="Export PDF"
                    onclick="app.handlers.openDownloadModal()">
                    <i data-lucide="download" class="w-4 h-4 text-base-content/70"></i>
                </button>
            </div>
        </header>

        <!-- DASHBOARD AREA -->
        <div id="contentArea" class="flex-1 overflow-y-auto p-6 relative">
            <!-- Content Injected Here -->
            <div class="flex flex-col items-center justify-center h-full text-base-content/50">
                <i data-lucide="layout-grid" class="w-12 h-12 mb-4 opacity-50"></i>
                <p>Wähle eine Klasse aus oder erstelle eine neue.</p>
            </div>
        </div>
    </main>

    <!-- MODALS -->

    <!-- Login Modal -->
    <dialog id="modal_login" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none w-full max-w-sm">
            <h3 class="font-bold text-2xl mb-2 text-center">Login</h3>
            <p class="text-center text-base-content/50 mb-6">Bitte identifiziere dich.</p>

            <div class="flex flex-col gap-4">
                <label class="form-control w-full">
                    <div class="label"><span class="label-text">Dein Name (Lehrer)</span></div>
                    <input type="text" id="inputLoginName" placeholder="z.B. Herr Müller"
                        class="input input-bordered w-full rounded-full shadow-none" />
                </label>

                <label class="form-control w-full">
                    <div class="label"><span class="label-text">Geheimes Passwort</span></div>
                    <input type="password" id="inputLoginPassword" placeholder="••••••••"
                        class="input input-bordered w-full rounded-full shadow-none" />
                </label>

                <p id="loginError" class="text-error text-sm text-center hidden flex items-center justify-center gap-1">
                    <i data-lucide="alert-circle" class="w-3 h-3"></i>
                    <span>Falsches Passwort</span>
                </p>
            </div>

            <div class="modal-action flex-col gap-2">
                <button class="btn btn-primary rounded-full w-full shadow-none" onclick="app.handlers.submitLogin()">
                    Anmelden
                </button>
            </div>
        </div>
        <!-- No backdrop close for login -->
    </dialog>

    <!-- Add Class Modal -->
    <dialog id="modal_add_class" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none">
            <h3 class="font-bold text-xl mb-6">Neue Klasse erstellen</h3>
            <div class="flex flex-col gap-4">
                <label class="form-control w-full">
                    <div class="label"><span class="label-text">Klassenname (z.B. 10B)</span></div>
                    <input type="text" id="inputClassName" placeholder="10B"
                        class="input input-bordered w-full rounded-full shadow-none" />
                </label>
            </div>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-primary rounded-full px-8 shadow-none"
                        onclick="app.handlers.submitNewClass()">Erstellen</button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- NEW MODALS -->

    <!-- Add Student Modal -->
    <dialog id="modal_add_student" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none">
            <h3 class="font-bold text-xl mb-6 flex items-center gap-2">
                <i data-lucide="user-plus" class="w-6 h-6 text-primary"></i>
                Neuer Schüler
            </h3>
            <div class="flex flex-col gap-4">
                <label class="form-control w-full">
                    <div class="label"><span class="label-text">Vor- und Nachname</span></div>
                    <input type="text" id="inputStudentName" placeholder="Max Mustermann"
                        class="input input-bordered w-full rounded-full shadow-none" />
                </label>
            </div>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-primary rounded-full px-8 shadow-none"
                        onclick="app.handlers.submitNewStudent()">
                        <i data-lucide="plus" class="w-4 h-4"></i> Hinzufügen
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Delete Class Modal -->
    <dialog id="modal_delete_class" class="modal">
        <div class="modal-box rounded-box border border-error/20 bg-base-100 p-8 shadow-none">
            <h3 class="font-bold text-xl mb-4 text-error flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                Klasse wirklich löschen?
            </h3>
            <p class="py-4 text-base-content/70">
                Möchtest du diese Klasse und alle darin enthaltenen Schüler und Daten wirklich löschen?
                <br><strong>Dieser Vorgang kann nicht rückgängig gemacht werden.</strong>
            </p>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-error btn-outline rounded-full px-8 shadow-none"
                        onclick="app.handlers.confirmDeleteClass()">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> Endgültig löschen
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Delete Student Modal -->
    <dialog id="modal_delete_student" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none">
            <h3 class="font-bold text-xl mb-4 flex items-center gap-2">
                <i data-lucide="user-x" class="w-6 h-6 text-base-content/70"></i>
                Schüler löschen?
            </h3>
            <p class="py-4 text-base-content/70">
                Soll dieser Schüler wirklich aus der Liste entfernt werden?
            </p>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-error btn-outline rounded-full px-8 shadow-none"
                        onclick="app.handlers.confirmDeleteStudent()">
                        <i data-lucide="trash" class="w-4 h-4"></i> Löschen
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Custom Lateness Modal -->
    <dialog id="modal_custom_lateness" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none">
            <h3 class="font-bold text-xl mb-6 flex items-center gap-2">
                <i data-lucide="clock" class="w-6 h-6 text-primary"></i>
                Verspätung bearbeiten
            </h3>
            <div class="flex flex-col gap-4">
                <label class="form-control w-full">
                    <div class="label"><span class="label-text">Minuten eingeben</span></div>
                    <input type="number" id="inputLatenessMinutes" placeholder="z.B. 45"
                        class="input input-bordered w-full rounded-full shadow-none" min="0" />
                </label>
            </div>
            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-primary rounded-full px-8 shadow-none"
                        onclick="app.handlers.submitCustomLateness()">
                        <i data-lucide="save" class="w-4 h-4"></i> Speichern
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Download Configuration Modal -->
    <dialog id="modal_download" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none w-11/12 max-w-2xl">
            <h3 class="font-bold text-xl mb-6 flex items-center gap-2">
                <i data-lucide="file-down" class="w-6 h-6 text-primary"></i>
                Bericht herunterladen
            </h3>

            <div class="space-y-6">
                <!-- Month Selection -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-sm uppercase tracking-wider text-base-content/50">Monate auswählen
                        </h4>
                        <button class="btn btn-xs btn-ghost text-primary" onclick="app.handlers.toggleAllMonths()">
                            Ganzes Jahr auswählen
                        </button>
                    </div>
                    <div class="grid grid-cols-3 md:grid-cols-4 gap-2" id="downloadMonthGrid">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Student Filter -->
                <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                    <input type="checkbox" />
                    <div class="collapse-title font-medium">
                        Schüler filtern (<span id="downloadStudentCount">Alle</span>)
                    </div>
                    <div class="collapse-content">
                        <div class="form-control" id="downloadStudentList">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- Summary Toggle -->
                <div class="form-control">
                    <label class="label cursor-pointer justify-start gap-4">
                        <input type="checkbox" class="toggle toggle-primary" id="toggleDownloadSummary" checked />
                        <span class="label-text font-medium">Zusammenfassung hinzufügen</span>
                    </label>
                </div>
            </div>

            <div class="modal-action">
                <form method="dialog">
                    <button class="btn btn-ghost rounded-full mr-2">Abbrechen</button>
                    <button class="btn btn-primary rounded-full px-8 shadow-none"
                        onclick="app.handlers.submitDownload()">
                        <i data-lucide="download" class="w-4 h-4"></i> PDF Erstellen
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- Alert Modal -->
    <dialog id="modal_alert" class="modal">
        <div class="modal-box rounded-box border border-base-300 bg-base-100 p-8 shadow-none text-center">
            <div class="flex justify-center mb-4">
                <div class="w-12 h-12 rounded-full bg-base-200 flex items-center justify-center">
                    <i data-lucide="info" class="w-6 h-6 text-primary"></i>
                </div>
            </div>
            <h3 class="font-bold text-xl mb-2" id="alertTitle">Hinweis</h3>
            <p class="py-2 text-base-content/70" id="alertMessage">
                <!-- Message injected here -->
            </p>
            <div class="modal-action justify-center">
                <form method="dialog">
                    <button class="btn btn-primary rounded-full px-8 shadow-none w-full">
                        OK
                    </button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <!-- JS MODULES -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/store.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>